#!/usr/bin/env ruby

puts '== Instalando dependÃªncias =='
system 'gem install bundler --conservative'
system('bundle check') || system('bundle install')
require 'sqlite3'

puts "\n== Preparando banco de dados =="

DB_FILE = "ibge_nomes.db"

return puts "\n== Database found ==" if File.exist? DB_FILE

begin
  db = SQLite3::Database.open DB_FILE
  db.execute <<~SQL
    CREATE TABLE Estados(
      id integer PRIMARY KEY,
      sigla varchar(10) NOT NULL,
      nome varchar(100) NOT NULL
    );
  SQL
  db.execute <<~SQL
      CREATE TABLE Cidades(
      id integer PRIMARY KEY,
      sigla varchar(10) NOT NULL,
      nome varchar(100) NOT NULL
    );
  SQL

rescue SQLite3::Exception => e
  puts e
ensure
  db.close if db
end